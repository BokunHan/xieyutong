{
	"bsonType": "object",
	"description": "会员信息表，通过user_id关联uni-id-users实现会员机制",
	"required": ["user_id", "level", "status"],
	"permission": {
		"read": "auth.uid == doc.user_id || 'MANAGE_MEMBERS' in auth.permission || 'admin' in auth.role || 'super_admin' in auth.role",
		"create": "auth.uid != null && ('MANAGE_MEMBERS' in auth.permission || 'admin' in auth.role || 'super_admin' in auth.role)",
		"update": "auth.uid == doc.user_id || 'MANAGE_MEMBERS' in auth.permission || 'admin' in auth.role || 'super_admin' in auth.role",
		"delete": "'MANAGE_MEMBERS' in auth.permission || 'admin' in auth.role || 'super_admin' in auth.role",
		"count": true
	},
	"properties": {
		"_id": {
			"description": "系统自动生成的唯一标识"
		},
		"user_id": {
			"bsonType": "string",
			"description": "关联的用户ID（uni-id-users表的_id）",
			"title": "用户ID",
			"required": true,
			"maxLength": 50,
			"foreignKey": "uni-id-users._id",
			"foreignTable": "uni-id-users",
			"foreignField": "_id"
		},
		"level": {
			"bsonType": "string",
			"description": "会员等级",
			"title": "会员等级",
			"enum": ["normal", "silver", "gold", "diamond"],
			"default": "normal",
			"required": true
		},
		"total_consumption": {
			"bsonType": "number",
			"description": "累计消费金额",
			"title": "累计消费",
			"default": 0,
			"minimum": 0
		},
		"order_count": {
			"bsonType": "number",
			"description": "订单数量",
			"title": "订单数量",
			"default": 0,
			"minimum": 0
		},
		"upgrade_threshold": {
			"bsonType": "object",
			"description": "升级条件阈值",
			"title": "升级条件",
			"properties": {
				"next_level": {
					"bsonType": "string",
					"description": "下一个等级",
					"enum": [{
							"value": "silver",
							"text": "银卡会员"
						},
						{
							"value": "gold",
							"text": "金卡会员"
						},
						{
							"value": "diamond",
							"text": "钻石会员"
						} {
							"value": "max",
							"text": "满级"
						}
					]
				},
				"required_consumption": {
					"bsonType": "number",
					"description": "所需消费金额",
					"minimum": 0
				},
				"required_orders": {
					"bsonType": "number",
					"description": "所需订单数量",
					"minimum": 0
				}
			}
		},
		"benefits": {
			"bsonType": "object",
			"description": "会员权益",
			"title": "会员权益",
			"properties": {
				"discount_rate": {
					"bsonType": "number",
					"description": "折扣率（0.95表示95折，1.0表示无折扣）",
					"minimum": 0,
					"maximum": 1,
					"default": 1
				}
			}
		},
		"status": {
			"bsonType": "string",
			"description": "会员状态",
			"enum": [{
					"value": "active",
					"text": "活跃"
				},
				{
					"value": "inactive",
					"text": "非活跃"
				},
				{
					"value": "suspended",
					"text": "冻结"
				}
			],
			"default": "active",
			"required": true
		},
		"join_date": {
			"bsonType": "timestamp",
			"description": "加入会员时间",
			"forceDefaultValue": {
				"$env": "now"
			}
		},
		"upgrade_date": {
			"bsonType": "timestamp",
			"description": "最后升级时间"
		},
		"expire_date": {
			"bsonType": "timestamp",
			"description": "会员到期时间（如果有期限的话）"
		},
		"created_at": {
			"bsonType": "timestamp",
			"description": "创建时间",
			"forceDefaultValue": {
				"$env": "now"
			}
		},
		"updated_at": {
			"bsonType": "timestamp",
			"description": "更新时间",
			"forceDefaultValue": {
				"$env": "now"
			}
		}
	}
}