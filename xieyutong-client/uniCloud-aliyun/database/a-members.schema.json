{
  "bsonType": "object",
  "description": "会员信息表，通过user_id关联uni-id-users实现会员机制",
  "required": ["user_id", "level", "status"],
  "permission": {
    "read": "auth.uid == doc.user_id || role in ['admin', 'super_admin']",
    "create": "auth.uid != null || role in ['admin', 'super_admin']",
    "update": "auth.uid == doc.user_id || role in ['admin', 'super_admin']",
    "delete": "role in ['admin', 'super_admin']",
    "count": true
  },
  "properties": {
    "_id": {
      "description": "系统自动生成的唯一标识"
    },
    "user_id": {
      "bsonType": "string",
      "description": "关联的用户ID（uni-id-users表的_id）",
      "title": "用户ID",
      "required": true,
      "maxLength": 50
    },
    "level": {
      "bsonType": "string",
      "description": "会员等级",
      "title": "会员等级",
      "enum": ["normal", "silver", "gold", "diamond"],
      "default": "normal",
      "required": true
    },
    "total_consumption": {
      "bsonType": "number",
      "description": "累计消费金额",
      "title": "累计消费",
      "default": 0,
      "minimum": 0
    },
    "order_count": {
      "bsonType": "number",
      "description": "订单数量",
      "title": "订单数量",
      "default": 0,
      "minimum": 0
    },
    "upgrade_threshold": {
      "bsonType": "object",
      "description": "升级条件阈值",
      "title": "升级条件",
      "properties": {
        "next_level": {
          "bsonType": "string",
          "description": "下一个等级",
          "enum": ["silver", "gold", "diamond", "max"]
        },
        "required_consumption": {
          "bsonType": "number",
          "description": "所需消费金额",
          "minimum": 0
        },
        "required_orders": {
          "bsonType": "number",
          "description": "所需订单数量",
          "minimum": 0
        }
      }
    },
    "benefits": {
      "bsonType": "object",
      "description": "会员权益",
      "title": "会员权益",
      "properties": {
        "discount_rate": {
          "bsonType": "number",
          "description": "折扣率（0.95表示95折，1.0表示无折扣）",
          "minimum": 0,
          "maximum": 1,
          "default": 1
        }
      }
    },
    "status": {
      "bsonType": "string",
      "description": "会员状态",
      "enum": ["active", "inactive", "suspended"],
      "default": "active",
      "required": true
    },
    "join_date": {
      "bsonType": "timestamp",
      "description": "加入会员时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "upgrade_date": {
      "bsonType": "timestamp",
      "description": "最后升级时间"
    },
    "expire_date": {
      "bsonType": "timestamp",
      "description": "会员到期时间（如果有期限的话）"
    },
    "created_at": {
      "bsonType": "timestamp",
      "description": "创建时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "updated_at": {
      "bsonType": "timestamp",
      "description": "更新时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    }
  }
} 